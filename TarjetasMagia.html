<html>
<head>
<meta charset="utf-8" />
<title>Tarjetas de conjuros</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="javascript/TM_magia.js"></script>

<script src="javascript/pdfform.minipdf.dist.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.0.0/FileSaver.min.js"></script>

<script>
		
	function rellenaPDF(tipo) {
		var lHechizos = magia.listaHechizos(tipo);
		var numHechizos = magia.numeroHechizos(tipo);
		var nombrecheck = "c" + tipo.toLowerCase();
		var hechizosSeleccionados = [];
		var i=0;
		var num=0;
		for (i=0; i<lHechizos.length; i++) {
			if ( document.getElementById(nombrecheck + i).checked ) {
				hechizosSeleccionados.push(lHechizos[i]);
				num++;
			}
			if ( num == numHechizos ) {
				break;
			}
		}
		if ( num == 0 ) {
			for (i=0; i<lHechizos.length && i<numHechizos; i++) {
				hechizosSeleccionados.push(lHechizos[i]);
			}
		}
		
		
		var xhr = new XMLHttpRequest();
		var contenido;
		var competencias = '';
		
		xhr.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
			  contenido = this.response;
			  var fields = magia.rellenaPDF(tipo, hechizosSeleccionados);
			  var out_buf = pdfform().transform(contenido, fields);
			  var blob = new Blob([out_buf], {type: 'application/pdf'});
			  saveAs(blob, 'Tarjeta ' + tipo + '.pdf'); 
			}
		};



		xhr.open('GET', magia.nombrePDF(tipo), true);
		xhr.responseType = 'arraybuffer';
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.send();	
	}
	
	function cargahechizos() {
		var i=0;
		var lTrucos = magia.listaHechizos("Trucos");
		var trucos = "<h2>Selecciona un máximo de " + magia.numeroHechizos("Trucos") + " trucos</h2><ul>"; 
		for (i=0;i<lTrucos.length;i++) {
			trucos += "<li><label><input type='checkbox' id='ctrucos"+i+"' /> " + lTrucos[i] + "</label></li>";
		}
		trucos += "</ul>";
		
		var lConjuros = magia.listaHechizos("Conjuros");
		var conjuros = "<h2>Selecciona un máximo de " + magia.numeroHechizos("Conjuros") + " conjuros</h2><ul>";
		for (i=0;i<lConjuros.length;i++) {
			conjuros += "<li><label><input type='checkbox' id='cconjuros"+i+"' /> " + lConjuros[i] + "</label></li>";
		}
		conjuros += "</ul>";
		var lRituales = magia.listaHechizos("Rituales");
		var rituales = "<h2>Selecciona un máximo de " + magia.numeroHechizos("Rituales") + " rituales</h2><ul>";
		for (i=0;i<lRituales.length;i++) {
			rituales += "<li><label><input type='checkbox' id='crituales"+i+"' /> " + lRituales[i] + "</label></li>";
		}
		rituales += "</ul>";
		
		document.getElementById("trucos").innerHTML = trucos;
		document.getElementById("conjuros").innerHTML = conjuros;
		document.getElementById("rituales").innerHTML = rituales;
	}
	
</script>

<style>
	
* {
  box-sizing: border-box;
}
.minileft {
  float:left;
  width:16%;
  padding:0 1px;
}
.left {
  float:left;
  width:33%;
  padding:0 1px;
}
.microleft {
  float:left;
  width:8%;
  padding:0 1px;
}
.main {
  float:left;
  width:34%;
  padding:0 1px;
}
.right {
  float:left;
  width:33%;
  padding:0 1px;
}
.macroright {
  float:left;
  width:46%;
  padding:0 1px;
}
.casitotal {
  float:left;
  width:82%;
  padding:0 1px;
}
.total {
  float:left;
  width:100%;
  padding:0 1px;
}
.dostercios {
  float:left;
  width:67%;
  padding:0 1px;
}



@media only screen and (max-width:820px) {
  /* For mobile phones: */
  .left, .main, .minileft, .microleft, .macroright, .right, .casitotal, .total, .minileft, .dostercios {
    width:100%;
  }
  
</style>


</head>
<body >

	<div class="w3-container w3-blue w3-center">
	  <h2>Tarjetas de conjuros</h2>
	</div>
	<div style="overflow:auto">
		<!--<div class="minileft" id="botonCarga"><p><button class='w3-button w3-block w3-blue' onclick='cargahechizos()'>Carga hechizos</button></p></div>-->
		<div class="left" id="botonpdfTrucos"><p><button class='w3-button w3-block w3-blue' onclick='rellenaPDF("Trucos")'>Genera PDF trucos</button></p></div>
		<div class="main" id="botonpdfConjuros"><p><button class='w3-button w3-block w3-blue' onclick='rellenaPDF("Conjuros")'>Genera PDF conjuros</button></p></div>
		<div class="right" id="botonpdfRituales"><p><button class='w3-button w3-block w3-blue' onclick='rellenaPDF("Rituales")'>Genera PDF rituales</button></p></div>
	</div>
	<div style="overflow:auto">
	
		<div class="left">
			<div class="w3-container w3-blue w3-center"><p><strong>Trucos</strong></p></div> 
			<div id="trucos"></div>
		</div>
		<div class="main">
			<div class="w3-container w3-blue w3-center"><p><strong>Conjuros</strong></p></div> 
			<div id="conjuros"></div>
		</div>
		<div class="right">
			<div class="w3-container w3-blue w3-center"><p><strong>Rituales</strong></p></div> 
			<div id="rituales"></div>
		</div>
	</div>	
	<script>cargahechizos();</script>
</body>	
</html>
