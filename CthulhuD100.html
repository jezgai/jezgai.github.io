<html>
<head>
<meta charset="utf-8" />
<title>Cthulhu D100 - Ayuda para crear personajes<</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="javascript/CD_comun.js"></script>
<script src="javascript/CD_PJ.js"></script>
<script src="javascript/CD_profesion.js"></script>

<script>
	
	
	let profesiones = new Profesiones();

	let pj = new CD_PJ();
	
	let nombreprofesion = 'random';
	let hayprofesiones = 0;
	
	let sprofesiones = Comun.desplegableProfesiones(profesiones, "seleccionaprofesion");
	
	

	function seleccionaprofesion(thelist) {
		var idx = thelist.selectedIndex;
		var seleccionado = thelist.options[idx].innerHTML;
		if ( idx < 1 ) {
			seleccionado = 'random';
		}
		nombreprofesion = seleccionado;
	}
		
	
	/*function arriba(atributo) {
		if ( atributo == 'FUE' ) {
			var fue = pj.FUE;
			var est = pj.EST;
			pj.FUE = pj.EST-3;
			pj.EST = fue+3;
		}
		else if ( atributo == 'CON' ) {
			var fue = pj.FUE;
			var con = pj.CON;
			pj.FUE = pj.CON;
			pj.CON = fue;
		}
		else if ( atributo == 'DES' ) {
			var des = pj.DES;
			var con = pj.CON;
			pj.DES = pj.CON;
			pj.CON = des;
		}
		else if ( atributo == 'POD' ) {
			var des = pj.DES;
			var pod = pj.POD;
			pj.DES = pj.POD;
			pj.POD = des;
		}
		else if ( atributo == 'CAR' ) {
			var car = pj.CAR;
			var pod = pj.POD;
			pj.CAR = pj.POD;
			pj.POD = car;
		}
		else {
			var car = pj.CAR;
			var est = pj.EST;
			pj.CAR = pj.EST;
			pj.EST = car;
		}
		pintaatributos();
	}*/

	function abajo(atributo) {
		if ( atributo == 'FUE' ) {
			var fue = pj.FUE;
			var con = pj.CON;
			pj.FUE = pj.CON;
			pj.CON = fue;
		}
		else if ( atributo == 'CON' ) {
			var des = pj.DES;
			var con = pj.CON;
			pj.DES = pj.CON;
			pj.CON = des;
		}
		else if ( atributo == 'DES' ) {
			var des = pj.DES;
			var pod = pj.POD;
			pj.DES = pj.POD;
			pj.POD = des;
		}
		else if ( atributo == 'POD' ) {
			var car = pj.CAR;
			var pod = pj.POD;
			pj.CAR = pj.POD;
			pj.POD = car;
		}
		else if ( atributo == 'CAR' ) {
			var car = pj.CAR;
			var est = pj.EST;
			pj.CAR = pj.EST-3;
			pj.EST = car+3;
		}
		else if ( atributo == 'EST' ) {
			var fue = pj.FUE;
			var est = pj.EST;
			pj.FUE = pj.EST-3;
			pj.EST = fue+3;
		}
		else if ( atributo == 'TAM' ) {
			var tam = pj.TAM;
			var int = pj.INT;
			pj.TAM = pj.INT;
			pj.INT = tam;
		}
		
		pintaatributos();
		pintaderivados();
		pintahabilidadesbase();
	}

	function construyeBoton(atributo)
	{
		return "</button><button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"abajo('" + atributo + "')\">&#9660;</button>";
	   //var strbutton = "<button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"arriba('" + atributo + "')\">&#9650;</button><button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"abajo('" + atributo + "')\">&#9660;</button>";
	   //return strbutton;
	}
	function pintaatributos() {
		document.getElementById("atributos").innerHTML = "<table class='w3-table  w3-striped  w3-border'><tr><td><strong>FUE</strong></td><td>" + pj.FUE +
													  " </td><td>" + 5*pj.FUE + 
													  " </td><td>" + construyeBoton('FUE') + "</td></tr>" +
            		                                  "<tr><td><strong>CON</strong></td><td>" + pj.CON +
													  " </td><td>" + 5*pj.CON + 
													  " </td><td>" + construyeBoton('CON') + "</td></tr>" +
													  "<tr><td><strong>DES</strong></td><td>" + pj.DES +
													  " </td><td>" + 5*pj.DES + 
													  " </td><td>" + construyeBoton('DES') + "</td></tr>" +
													  "<tr><td><strong>POD</strong></td><td>" + pj.POD +
													  " </td><td>" + 5*pj.POD + 
													  " </td><td>" + construyeBoton('POD') + "</td></tr>" +
													  "<tr><td><strong>CAR</strong></td><td>" + pj.CAR +
													  " </td><td>" + 5*pj.CAR + 
													  " </td><td>" + construyeBoton('CAR') + "</td></tr>" + 
													  "<tr><td><strong>EST</strong></td><td>" + pj.EST +
													  " </td><td>" + 5*pj.EST + 
													  " </td><td>" + construyeBoton('EST') + "</td></tr></table>";

		document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border'><tr><td><strong>TAM</strong></td><td>" + pj.TAM +
													  " </td><td>" + 5*pj.TAM + 
													  " </td><td>" + construyeBoton('TAM') + "</td></tr>" +
													  "<tr><td><strong>INT</strong></td><td>" + pj.INT +
													  " </td><td>" + 5*pj.INT + 
													  " </td><td> </td></tr></table>";													  
													  
	}
	
	function pintaderivados() {		
		document.getElementById("derivados").innerHTML = "<table class='w3-table  w3-striped  w3-border'><tr><td><strong>PV</strong></td><td>" + pj.PV + "</td></tr>" +
            		                                  "<tr><td><strong>Umbral de herida grave</strong></td><td>" + pj.UmbralHerida + "</td></tr>" +
													  "<tr><td><strong>Modificador al daño</strong></td><td>" + pj.MD + "</td></tr>" +
													  "<tr><td><strong>Daño simplificado</strong></td><td>" + pj.DSimplificado + "</td></tr>" +
													  "<tr><td><strong>Idea</strong></td><td>" + pj.Idea + "</td></tr>" +
													  "<tr><td><strong>Cultura general</strong></td><td>" + pj.CulturaGeneral + "</td></tr>" +
													  "<tr><td><strong>Suerte</strong></td><td>" + pj.Suerte + "</td></tr>" +
													  "<tr><td><strong>PM</strong></td><td>" + pj.PM + "</td></tr>" +
													  "<tr><td><strong>Fuerza de voluntad</strong></td><td>" + pj.FuerzaVoluntad + "</td></tr>" +
            		                                  "<tr><td><strong>Puntos en habilidades profesión</strong></td><td>" + pj.PtosProfesion + "</td></tr>" +
													  "<tr><td><strong>Puntos habilidades</strong></td><td>" + pj.PtosResto + "</td></tr></table>";
	}
	
	function pintahabilidadesbase() {
		var intimidar = pj.INT * 2;
		if ( pj.TAM > pj.INT )
			intimidar = pj.TAM * 2;
		document.getElementById("habilidadesbase").innerHTML = "<table class='w3-table  w3-striped  w3-border'><tr><td><strong>Idioma Nativo (EST*5)</strong></td><td>" + (pj.EST*5) + "</td>" +
            		                                  "<td><strong>Autoridad (EST+CAR)</strong></td><td>" + (pj.EST + pj.CAR) + "</td></tr>" +
													  "<tr><td><strong>Esquivar (DES*2)</strong></td><td>" + (pj.DES*2) + "</td>" +
													  "<td><strong>Intimidar (TAM*2 ó INT*2)</strong></td><td>" + intimidar + "</td></tr>" +
													  "<tr><td><strong>Forma física (FUE+DES)</strong></td><td>" + (pj.FUE + pj.DES) + "</td>" +
													  "<td><strong>Protocolo (EST*2)</strong></td><td>" + (pj.EST*2) + "</td></tr>" +
													  "<tr><td><strong>Lucha (DES*2)</strong></td><td>" + (pj.DES*2) + "</td></tr></table>";
	}
	
	function calcula() {
		
		var habilidades = "";
		var nbprofesion = nombreprofesion;
		if ( hayprofesiones == 1) {
			profesion = profesiones.profesion(nombreprofesion);
			habilidades = profesion.habilidades;
			nbprofesion = profesion.nombre;
		}
		
		pj = new CD_PJ();
		pj.genera();
		
		
		pintaatributos();
		pintaderivados();
		
		if ( hayprofesiones == 1 )
		{
			document.getElementById("profesion").innerHTML="<p><strong><center>PROFESIÓN: " + nbprofesion + "</center></strong></p>";
			document.getElementById("habilidades").innerHTML= "<br/><table class='w3-table  w3-striped  w3-border' <tr><td><strong>Habilidades de " + nbprofesion + "</strong></td></tr><tr><td>" + habilidades + "</td></tr></table>";
		}
		pintahabilidadesbase();
	}
	
	function descarga() {
		var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(pj));
		var jsonElem = document.getElementById('downloadpjsonpj');
		jsonElem.setAttribute("href",     dataStr     );
		jsonElem.setAttribute("download", "pj.json");
		jsonElem.click();
		
	}
	
	function conprofesiones() {
		document.getElementById("atributos").innerHTML="";
		document.getElementById("derivados").innerHTML="";
		document.getElementById("habilidades").innerHTML="";
		document.getElementById("profesion").innerHTML="";
		
		hayprofesiones = 1;
		document.getElementById("profesiones").innerHTML = sprofesiones;
		//document.getElementById("botonprofesion").innerHTML = "<p></p>";
	}
	
</script>
</head>
<body >
	<div class="w3-container w3-gray w3-center">
	  <h2>Cthulhu D100 - Ayuda para crear personajes</h2>
	</div>
	<div class="w3-row">
		<div class="w3-col s1"><p></p></div>
		<div class="w3-col s1" id="profesiones"><p><button class='w3-button w3-block w3-teal' onclick='conprofesiones()'>Profesiones</button></p></div>
		<div class="w3-col s2"><p></p></div>
		<div class="w3-col s3"><p><button class='w3-button w3-block w3-gray' onclick='calcula()'>Calcula</button></p></div>
		<div class="w3-col s2" id="profesion"><p></p></div>
		<div class="w3-col s2"><p></p></div>
		<div class="w3-col s1"><p><button  style="display:none" class='w3-button w3-block w3-teal' onclick='descarga()'>Descarga</button></p></div>
	</div>
	<div class="w3-row">
		<div class="w3-col s4 w3-center w3-gray">
			<p><strong>Atributos</strong></p>
		</div>
		<div class="w3-col s4 w3-center w3-gray">
			<p><strong>Derivados</strong></p>
		</div>
		<div class="w3-col s4 w3-center w3-gray">
			<p><strong>Habilidades de profesión</strong></p>
		</div>
	</div> 
	<div class="w3-row">
		<div class="w3-col s4 w3-center" id="atributos"></div>
		<div class="w3-col s4 w3-center" id="derivados"></div>
		<div class="w3-col s4 w3-center" id="habilidades"></div>
	</div> 
	<div class="w3-row">
		<div class="w3-col s12 w3-center w3-gray"><strong>Puntuaciones base de habilidades (derivadas)</strong></div>
	</div>
	<div class="w3-row">
		<div class="w3-col s12 w3-center" id="habilidadesbase"></div>
	</div>
	<a id="downloadpjsonpj" style="display:none"></a>
	<script>conprofesiones();</script>
</body>
</html>

