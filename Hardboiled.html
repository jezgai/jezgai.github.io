<html>
<head>
<meta charset="utf-8" />
<title>Hardboiled - Ayuda para crear personajes<</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="javascript/HB_comun.js"></script>
<script src="javascript/HB_PJ.js"></script>
<script src="javascript/HB_profesion.js"></script>

<script>
	
	
	let profesiones = new Profesiones();

	let pj = new HB_PJ();
	
	let nombreprofesion = 'random';
	let hayprofesiones = 0;
	
	let sprofesiones = Comun.desplegableProfesiones(profesiones, "seleccionaprofesion");
	let requisitos = "";
	

	function seleccionaprofesion(thelist) {
		var idx = thelist.selectedIndex;
		var seleccionado = thelist.options[idx].innerHTML;
		if ( idx < 1 ) {
			seleccionado = 'random';
		}
		nombreprofesion = seleccionado;
	}
		
	
	/*function arriba(atributo) {
		if ( atributo == 'vigor' ) {
			var vigor = pj.vigor;
			var carisma = pj.carisma;
			pj.vigor = pj.carisma;
			pj.carisma = vigor;
			if ( vigor != pj.vigor ) {
				pj.calculapegadapv();
				pj.rangomovimiento();
			}
			if ( carisma != pj.carisma ) {
				pj.porccarisma();
			}
		}
		else if ( atributo == 'destreza' ) {
			var vigor = pj.vigor;
			var destreza = pj.destreza;
			pj.vigor = pj.destreza;
			pj.destreza = vigor;
			if ( vigor != pj.vigor ) {
				pj.calculapegadapv();
			}
		}
		else if ( atributo == 'perspicacia' ) {
			var perspicacia = pj.perspicacia;
			var destreza = pj.destreza;
			pj.perspicacia = pj.destreza;
			pj.destreza = perspicacia;
			if ( destreza != pj.destreza ) {
				pj.rangomovimiento();
			}
			if ( perspicacia != pj.perspicacia ) {
				pj.porcperspicacia();
			}
		}
		else {
			var perspicacia = pj.perspicacia;
			var carisma = pj.carisma;
			pj.perspicacia = pj.carisma;
			pj.carisma = perspicacia;
			if ( perspicacia != pj.perspicacia ) {
				pj.porcperspicacia();
			}
			if ( carisma != pj.carisma ) {
				pj.porccarisma();
			}
		}
		pintaatributos();
	}*/

	function abajo(atributo) {
		if ( atributo == 'vigor' ) {
			var vigor = pj.vigor;
			var destreza = pj.destreza;
			pj.vigor = pj.destreza;
			pj.destreza = vigor;
			if ( vigor != pj.vigor ) {
				pj.calculapegadapv();
			}
		}
		else if ( atributo == 'destreza' ) {
			var perspicacia = pj.perspicacia;
			var destreza = pj.destreza;
			pj.perspicacia = pj.destreza;
			pj.destreza = perspicacia;
			if ( destreza != pj.destreza ) {
				pj.rangomovimiento();
			}
			if ( perspicacia != pj.perspicacia ) {
				pj.porcperspicacia();
			}
		}
		else if ( atributo == 'perspicacia' ) {
			var perspicacia = pj.perspicacia;
			var carisma = pj.carisma;
			pj.perspicacia = pj.carisma;
			pj.carisma = perspicacia;
			if ( perspicacia != pj.perspicacia ) {
				pj.porcperspicacia();
			}
			if ( carisma != pj.carisma ) {
				pj.porccarisma();
			}
		}
		else {
			var vigor = pj.vigor;
			var carisma = pj.carisma;
			pj.vigor = pj.carisma;
			pj.carisma = vigor;
			if ( vigor != pj.vigor ) {
				pj.calculapegadapv();
				pj.rangomovimiento();
			}
			if ( carisma != pj.carisma ) {
				pj.porccarisma();
			}
		}
		pintaatributos();
		
	}

	function construyeBoton(atributo)
	{
		return "<button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"abajo('" + atributo + "')\">&#9660;</button>";
	   //var strbutton = "<button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"arriba('" + atributo + "')\">&#9650;</button><button class=\"w3-button w3-circle w3-green w3-padding-small w3-tiny\" onclick=\"abajo('" + atributo + "')\">&#9660;</button>";
	   //return strbutton;
	}
	function pintaatributos() {
		/*
		document.getElementById("atributos").innerHTML = "<p align='right'><strong>Vigor</strong>: " + pj.vigor + " " + construyeBoton('vigor') + "<br/><strong>Destreza</strong>: " + pj.destreza + " " + construyeBoton('destreza') + "<br/><strong>Perspicacia</strong>: " + pj.perspicacia + " " + construyeBoton('perspicacia') + "<br/><strong>Carisma</strong>: " + pj.carisma + " " + construyeBoton('carisma') + "</p><br/><strong>Suerte</strong>: " + pj.suerte;
		document.getElementById("atributos").innerHTML += "<br/><br/><strong>PV</strong>: " + pj.pv + "<br/><strong>Pegada</strong>: " + pj.pegada + "<br/><strong>Movimiento</strong>: " + pj.mov;  
		document.getElementById("atributos").innerHTML += "<br/><br/><hr/><strong>% extra en habilidades</strong>: +" + pj.porchabper + "%<br/><strong>% extra en habilidades sociales</strong>: +" + pj.porchabcar + "%";
		*/
		document.getElementById("atributos").innerHTML = "<table class='w3-table  w3-striped  w3-border'><tr><td><strong>Vigor</strong></td><td>" + pj.vigor +
													  " </td><td>" + construyeBoton('vigor') + "</td></tr>" + 
            		                                  "<tr><td><strong>Destreza</strong></td><td>" + pj.destreza +
													  " </td><td>" + construyeBoton('destreza') + "</td></tr>" +
													  "<tr><td><strong>Perspicacia</strong></td><td>" + pj.perspicacia +
													  " </td><td>" + construyeBoton('perspicacia') + "</td></tr>" + 
													  "<tr><td><strong>Carisma</strong></td><td>" + pj.carisma +
													  " </td><td>" + construyeBoton('carisma') + "</td></tr></table>";
		document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border'><tr><td><strong>Suerte</strong></td><td>" + pj.suerte + "</td></tr></table";
		document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border'><tr><td><strong>PV</strong></td><td>" + pj.pv + "</td></tr>" + 
            		                                  "<tr><td><strong>Pegada</strong></td><td>" + pj.pegada + "</td></tr>" +
													  "<tr><td><strong>Movimiento</strong></td><td>" + pj.mov + "</td></tr></table>";
		document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border'><tr><td><strong>% extra en habilidades</strong></td><td>" + pj.porchabper + "%</td></tr>" + 
													  "<tr><td><strong>% extra en habilidades sociales</strong></td><td>" + pj.porchabcar + "%</td></tr></table>";
		
		if ( requisitos != "" )
				document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border' <tr><td><strong>Requisitos</strong></td><td>" + requisitos + "</td></tr></table>";
				
		var tensionmental = Math.trunc(pj.perspicacia / 5) - 2;
		var tranquilo = Math.ceil(tensionmental / 2);
		var intranquilo = Math.trunc(tensionmental / 2);
		

		document.getElementById("estabmental").innerHTML = "<table class='w3-table  w3-striped  w3-border'><tr><td></td><td><center><strong>Estabilidad Mental</strong></center></td><td></td></tr>" + 
            		                                  "<tr><td><strong>Tranquilo</strong>: " + tranquilo + " </td>" +
            		                                  "<td><strong>Intranquilo</strong>: " + intranquilo + " </td>" +
            		                                  "<td><strong>Tenso</strong>: " + tranquilo + " </td></tr></table>";
            		                                              		                                  
		document.getElementById("hckestabmental").innerHTML = "La estabilidad mental es un pequeño hack copiado de Cthulhu D100, que utiliza en lugar de POD (que no existe en Hardboiled, la Perspicacia. " + 
														"Para ello se divide la perspicacia por 5, se redondea hacia abajo y se le resta 2 (<strong>" + tensionmental + "</strong>). " + 
														"Los valores de tranquilo, intranquilo y tenso se calculan de la misma forma que en Cthulhu D100 " + 
														"(tranquilo y tenso es el valor anterior dividido por 2 y redondeado hacia arriba e intranquilo igual pero redondeado hacia abajo";
	}
	
	
	function calcula() {
		/*tiraatributos();
		tirahabprimaria();
		tirahabsecundaria();*/
		
		//var objselect = document.getElementById("nsecun");
		//var idx = objselect.selectedIndex;
		//var nhabsec = idx + 6;
		var nhabprin = 5;
		var nhabsec = 10;
		var habilidadesprin = "";
		var habilidadessecun = "";
		var dotesinvestigativas = "";
		requisitos = "";
		var nbprofesion = nombreprofesion;
		if ( hayprofesiones == 1) {
			profesion = profesiones.profesion(nombreprofesion);
			nhabprin = profesion.nhabprincipales;
			nhabsec = profesion.nhabsecundarias;
			habilidadesprin = profesion.habprincipales;
			habilidadessecun = profesion.habsecundarias;
			dotesinvestigativas = profesion.dotesinvestigativas;
			requisitos = profesion.requisito;
			nbprofesion = profesion.nombre;
		}
		
		pj = new HB_PJ();
		pj.genera(nhabprin, nhabsec);
		
		
		pintaatributos();
		
		var strtabla = "<table class='w3-table  w3-striped  w3-border'>";
		var indpri=0;
		
		for (indpri=0;indpri<nhabprin;indpri++) {
			var n=1+indpri;
			var habn = pj.habprimarias[indpri];
			//document.getElementById("habprimaria").innerHTML += "<br/><strong>Puntuación " + n + "</strong>: " + habn;
			strtabla += "<tr><td><strong>Puntuación " + n + "</strong></td><td>" + habn + "</td></tr>";
		}
		strtabla += "</table>";
		document.getElementById("habprimaria").innerHTML = strtabla;
		//document.getElementById("habsecundaria").innerHTML="";
		
		strtabla = "<table class='w3-table  w3-striped  w3-border'>";
		
		var indsec=0;
		for (indsec=0;indsec<nhabsec;indsec++) {
			var n=1+indsec;
			var habn = pj.habsecundarias[indsec];
			//document.getElementById("habsecundaria").innerHTML += "<br/><strong>Puntuación " + n + "</strong>: " + habn;
			strtabla += "<tr><td><strong>Puntuación " + n + "</strong></td><td>" + habn + "</td></tr>";
		}
		
		strtabla += "</table>";
		document.getElementById("habsecundaria").innerHTML = strtabla;
		
		document.getElementById("dotesinvestigativas").innerHTML = "";
		document.getElementById("profesion").innerHTML="";
		if ( hayprofesiones == 1 )
		{
			document.getElementById("profesion").innerHTML="<p><strong><center>PROFESIÓN: " + nbprofesion + "</center></strong></p>";
			document.getElementById("habprimaria").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border' <tr><td><strong>Habilidades principales de " + nbprofesion + "</strong></td></tr><tr><td>" + habilidadesprin + "</td></tr></table>";
			document.getElementById("habsecundaria").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border' <tr><td><strong>Habilidades secundarias de " + nbprofesion + "</strong></td></tr><tr><td>" + habilidadessecun + "</td></tr></table>";
			document.getElementById("dotesinvestigativas").innerHTML += "<table class='w3-table  w3-striped  w3-border' <tr><td><strong>Dotes investigativas de " + nbprofesion + "</strong></td></tr><tr><td>" + dotesinvestigativas + "</td></tr></table>";
			//if ( requisitos != "" )
			//	document.getElementById("atributos").innerHTML += "<br/><table class='w3-table  w3-striped  w3-border' <tr><td><strong>Requisitos</strong></td><td>" + requisitos + "</td></tr></table>";
		}
		
	}
	
	function descarga() {
		var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(pj));
		var jsonElem = document.getElementById('downloadpjsonpj');
		jsonElem.setAttribute("href",     dataStr     );
		jsonElem.setAttribute("download", "pj.json");
		jsonElem.click();
		
	}
	
	function conprofesiones() {
		document.getElementById("atributos").innerHTML="";
		document.getElementById("habprimaria").innerHTML="";
		document.getElementById("habsecundaria").innerHTML="";
		document.getElementById("dotesinvestigativas").innerHTML="";
		document.getElementById("profesion").innerHTML="";
		
		hayprofesiones = 1;
		document.getElementById("profesiones").innerHTML = sprofesiones;
		//document.getElementById("botonprofesion").innerHTML = "<p></p>";
	}
	
</script>
</head>
<body >
	<div class="w3-container w3-green w3-center">
	  <h2>Hardboiled - Ayuda para crear personajes</h2>
	</div>
	<div class="w3-row">
		<div class="w3-col s1"><p></p></div>
		<div class="w3-col s1" id="profesiones"><p><button class='w3-button w3-block w3-teal' onclick='conprofesiones()'>Profesiones</button></p></div>
		<div class="w3-col s2"><p></p></div>
		<div class="w3-col s3 "><p><button class='w3-button w3-block w3-green' onclick='calcula()'><strong>Calcula</strong></button></p></div>
		<div class="w3-col s2" id="profesion"><p></p></div>
		<div class="w3-col s2"><p></p></div>
		<div class="w3-col s1"><p><button  style="display:none" class='w3-button w3-block w3-teal' onclick='descarga()'>Descarga</button></p></div>
	</div>
	<div class="w3-row">
		<div class="w3-col s3 w3-center w3-green">
			<p><strong>Atributos</strong></p>
		</div>
		<div class="w3-col s3 w3-center w3-green">
			<p><strong>Habilidades principales</strong></p>
		</div>
		<div class="w3-col s3 w3-center w3-green">
			<p><strong>Habilidades secundarias</strong></p>
		</div>
		<div class="w3-col s3 w3-center w3-green">
			<p><strong>Dotes investigativas</strong></p>
		</div>
	</div> 
	<div class="w3-row">
		<div class="w3-col s3 w3-center" id="atributos"></div>
		<div class="w3-col s3 w3-center" id="habprimaria"></div>
		<div class="w3-col s3 w3-center" id="habsecundaria"></div>
		<div class="w3-col s3 w3-center" id="dotesinvestigativas"></div>
	</div> 
	<p></p>
	<div class="w3-row">
		<div class="w3-col s12 w3-center w3-green">
			<p><strong>Estabilidad Mental (Opcional)</strong></p>
		</div>
	</div> 
	<div class="w3-row">
		<div class="w3-col s6 w3-center" id="estabmental"></div>
		<div class="w3-col s6 w3-center" id="hckestabmental"></div>
	</div>
	<a id="downloadpjsonpj" style="display:none"></a>
	<script>conprofesiones();</script>
</body>
</html>

